<div class="container-fluid">
  <div class="container-fluid">
    <div id="action-header" class="container-fluid">
      <div class="row">
        <div class="col">
          <div class="btn-group action-grp filter" dropdown placement="bottom right">
            <button dropdownToggle type="button" class="btn btn-primary dropdown-toggle">
              Filter By
              <span class="caret"></span>
            </button>
            <ul *dropdownMenu class="dropdown-menu dropdown-menu-right" role="menu" >
              <li role="menuitem" *ngFor="let category of categories">
                <a class="dropdown-item" (click)="filterByCategory(category.name)">{{category.name}}</a>
              </li>
              <li *ngIf="filterBy != 'none'" class="divider dropdown-divider"></li>
              <li role="menuitem" *ngIf="filterBy != 'none'">
                <a class="dropdown-item" (click)="filterByCategory('none')">None</a>
              </li>
            </ul>
          </div>
          <button type="button" class="btn btn-primary action-grp action-grp-btn" (click)="openProductModal(template, null)">Add Product</button>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <table class="table table-responsive" cellspacing="0" width="100%">
        <thead>
          <tr>
            <th scope="col" (click)="sort('name')">Name
              <span *ngIf="sortBy === 'name'" class="fa fa-long-arrow-down sort-icon" [ngClass]="{'icon-not-toggled': isDescNotToggled('name')}"></span>
              <span *ngIf="sortBy === 'name'" class="fa fa-long-arrow-up sort-icon" [ngClass]="{'icon-not-toggled': isAscNotToggled('name')}"></span>
            </th>
            <th scope="col" (click)="sort('category')">Category
              <span *ngIf="sortBy === 'category'" class="fa fa-long-arrow-down sort-icon" [ngClass]="{'icon-not-toggled': isDescNotToggled('category')}"
                (click)="sort()"></span>
              <span *ngIf="sortBy === 'category'" class="fa fa-long-arrow-up sort-icon" [ngClass]="{'icon-not-toggled': isAscNotToggled('category')}"></span>
            </th>
            <th scope="col" (click)="sort('price')">Price
              <span *ngIf="sortBy === 'price'" class="fa fa-long-arrow-down sort-icon" [ngClass]="{'icon-not-toggled': isDescNotToggled('price')}"></span>
              <span *ngIf="sortBy === 'price'" class="fa fa-long-arrow-up sort-icon" [ngClass]="{'icon-not-toggled': isAscNotToggled('price')}"></span>
            </th>
            <th scope="col" (click)="sort('stocks')">Available Stocks
              <span *ngIf="sortBy === 'stocks'" class="fa fa-long-arrow-down sort-icon" [ngClass]="{'icon-not-toggled': isDescNotToggled('stocks')}"></span>
              <span *ngIf="sortBy === 'stocks'" class="fa fa-long-arrow-up sort-icon" [ngClass]="{'icon-not-toggled': isAscNotToggled('stocks')}"></span>
            </th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let product of filteredProducts; let i = index">
            <td>{{ product.name }}</td>
            <td>{{ getCategoryById(product.categoryId) }}</td>
            <td>{{ product.price | currency }}</td>
            <td>{{ product.stocks }}</td>
            <td class="action-column">
              <button type="button" class="btn btn-warning action-grp action-grp-btn" (click)="openProductModal(template, product)">
                <span class="fa fa-pencil-square-o"></span>
              </button>
              <button type="button" class="btn btn-danger action-grp action-grp-btn" (click)="deleteProduct(product.id, i)">
                <span class="fa fa-times-circle"></span>
              </button>
            </td>
          </tr>
          <tr *ngIf="filteredProducts.length == 0">
            <td colspan="5" class="table-no-result">No data found.</td>
          </tr>
      </table>
    </div>
  </div>
</div>

<ng-template #template>
  <div class="modal-header">
    <h4 class="modal-title pull-left">Save Product</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modalRef.hide()">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form *ngIf="newProduct">
      <div class="form-group">
        <label for="product-name">Name</label>
        <input [(ngModel)]="newProduct.name" name="newProduct.name" type="text" class="form-control" id="product-name" placeholder="Enter product name">
      </div>
      <div class="form-group">
        <label for="product-category">Category</label>
        <select class="form-control" name="newProduct.categoryId" [(ngModel)]="newProduct.categoryId">
          <option *ngFor="let category of categories" [ngValue]="category.id">{{category.name}}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="product-price">Price</label>
        <input [(ngModel)]="newProduct.price" name="newProduct.price" type="number" class="form-control" id="product-name" placeholder="Enter price">
      </div>
      <div class="form-group">
        <label for="product-stocks">Available Stocks</label>
        <input [(ngModel)]="newProduct.stocks" name="newProduct.stocks" type="number" class="form-control" id="product-name" placeholder="Enter available stocks">
      </div>
      <div class="form-group">
        <label for="product-image">Image Url</label>
        <input [(ngModel)]="newProduct.imageUrl" name="newProduct.imageUrl" type="text" class="form-control" id="product-name" placeholder="Enter image url">
      </div>
      <div class="form-group image-url">
        <img [src]="newProduct.imageUrl" height="200px">
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="saveCategory()">OK</button>
    <button type="button" class="btn btn-default" (click)="modalRef.hide()">Cancel</button>
  </div>
</ng-template>